<!DOCTYPE html>
<html lang="en"xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>
    <!-- jquery cdn -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
<h1>회원가입 페이지</h1>
<hr>
<form action="/join" method="post">
    <div>
        <input type="text" name="username" id="username" placeholder="UserName"><br>
        <label id="label1"></label>
    </div>

    <input type="password" name="password" placeholder="Password"><br>
    <input type="number" name="phone" placeholder="PhoneNumber"><br>
    <input type="email" name="email" placeholder="Email"><br>
    <select name="role">
        <option value="ROLE_USER">회원님</option>
        <option value="ROLE_MANAGER">센터 원장님</option>
    </select><br>
    <input type="submit" value="가입하기"/>
</form>
<hr>
</body>
<script th:inline="javascript">
    $(document).ready(function() {

        $("#username").on("change", function() {
           var username = $("#username").val();
           console.log(username);

           if(username == '' || username.length == 0) {
               $("#label1").css("color", "red").text("공백은 ID로 사용할 수 없습니다.");
               return false;
           }

            $.ajax({
                type: "post",
                url: "/confirm" ,
                contentType: "application/json; charset=utf-8",
                data: { "username": username },


                success: function(result) {
                   console.log("ajax 요청 성공");
                   console.log(result);
                   if(result === true) {
                    $("#label1").css("color", "black").text("사용 가능한 ID 입니다.");
                   } else {
                    $("#label1").css("color", "red").text("사용 불가한 ID 입니다.");
                    $("#id").val("");
                   }
                },
                error: function(xhr, status, error) {
                   console.error("요청 실패:", error);
                   console.error("xhr: ", xhr);
                }
            });
        }); //change-end
    });//ready-end
</script>
</html>